import{u as E,f as k,r as y}from"./cart-CgKhjms7.js";const g=document.getElementById("search-results-wrapper"),p=document.getElementById("search-wrapper"),v=phpFileToken,w=phpFileUrl;class L{static handleClickOutsideSearch(t){!p.contains(t.target)&&t.target.id!="searchBtn"&&t.target.id!="searchBtnImg"?window.innerWidth<=1024?p.classList.replace("flex","hidden"):g.classList.replace("flex","hidden"):p.classList.replace("hidden","flex")}static async fetchSearchResults(t){if(t.trim()===""){g.classList.replace("flex","hidden");return}try{const r=await(await fetch(`/_api/product/search?query=${encodeURIComponent(t)}`,{method:"POST"})).json();console.log("Search results:",r),this.renderSearchResults(r)}catch(s){console.error("Error fetching search results:",s)}}static renderSearchResults(t){var s,r,d,l;(s=document.getElementById("search-roller"))==null||s.classList.replace("block","hidden"),t.length?((r=document.getElementById("none-found"))==null||r.classList.replace("block","hidden"),(d=document.getElementById("search-results"))==null||d.replaceChildren(),t.forEach(n=>{var e;const o=n.discounted_price?`
                    <div class="w-full text-sm text-left flex mb-1">
            
                        <div class="z-10 text-xl font-semibold mr-1"> ${n.discounted_price} <span class="text-[.83rem]">EGP</span></div>
                        <div class="z-10 text-gray-400 line-through flex translate-y-[6px] text-[.83rem]"> ${n.price} EGP</div>
    
                    </div>`:`<div class="z-10  mt-1 text-blue-500 mb-auto" :> ${n.price} EGP</div>`,i=`
                    <a  class="sm:flex-row flex-col flex p-2 pr-3 border-b-[1px] border-r-[1px] h-[10rem] sm:h-[6.6rem] w-1/2 border-gray-300 animate-fadeIn">
                        <img  class="object-contain rounded -translate-y-0 mb-auto w-auto lg:w-28 h-16 lg:h-24 mr-4" src="${w}/file/connect-store/product/${n.img_id}/0?Authorization=${v}&b2ContentDisposition=attachment" />
                        <div class ="flex flex-col">
                            <div class="text-ellipsis line-clamp-2 leading-6 mb-auto">${n.name}</div>    
                            <div>${o}</div>    
                        </div>
                    </a>
                `;(e=document.getElementById("search-results"))==null||e.insertAdjacentHTML("beforeend",i)})):(l=document.getElementById("none-found"))==null||l.classList.replace("hidden","block")}}const B=document.getElementById("search-input");document.addEventListener("click",L.handleClickOutsideSearch);var I;(I=document.getElementById("searchBtn"))==null||I.addEventListener("click",()=>{B.classList.replace("hidden","flex")});let h;B.addEventListener("input",a=>{var t,s,r;(t=document.getElementById("search-results"))==null||t.replaceChildren(),(s=document.getElementById("none-found"))==null||s.classList.replace("block","hidden"),(r=document.getElementById("search-roller"))==null||r.classList.replace("hidden","block"),g.classList.replace("hidden","flex"),h&&clearTimeout(h),h=setTimeout(()=>L.fetchSearchResults(a.target.value),1e3)});function C(){var n,o,i;const a=document.getElementById("cart-wrapper"),t=document.getElementById("order-popup"),s=document.getElementById("cartBtn");async function r(e){!e.composedPath().includes(a)&&e.target.id!="cartBtn"&&e.target.id!="cartBtnImg"&&!e.target.classList.contains("addToCartBtn")&&!e.target.classList.contains("addToCartText")&&!e.composedPath().includes(t)&&a.classList.replace("flex","hidden")}function d(){localStorage.setItem("cart_items",JSON.stringify([])),E(),y([])}async function l(e){console.log("what"),e.preventDefault();const m=e.target,c=document.getElementById("submit-btn");c.disabled=!0,c.innerHTML="Sending Order..";try{if(localStorage.getItem("cart_items")&&JSON.parse(localStorage.getItem("cart_items")).length){const u=new FormData(m);u.append("Products",localStorage.getItem("cart_items"));const x={method:"POST",headers:{"Access-Control-Allow-Credentials":"true",Accept:"multipart/form-data"},credentials:"include",body:u},b=location.protocol+"//"+location.host+"/_api/order/",f=await fetch(b,x);f.status===200?(c.innerHTML="Order Sent.",d(),m.reset()):(c.innerHTML="Failed to send order: "+f.status,c.disabled=!1)}}catch(u){throw c.innerHTML="Failed to send order: Unknown Error",c.disabled=!1,u}}E(),document.addEventListener("click",r),s.addEventListener("click",async e=>{const m=await k();y(m)},{once:!0}),s.addEventListener("click",async e=>{a.classList.replace("hidden","flex")}),(n=document.getElementById("cart-checkout"))==null||n.addEventListener("click",()=>{var e;(e=document.getElementById("order-popup"))==null||e.classList.replace("hidden","flex")}),(o=document.getElementById("close-order"))==null||o.addEventListener("click",()=>{document.getElementById("order-popup").classList.add("hidden")}),(i=document.getElementById("order-overlay"))==null||i.addEventListener("click",()=>{document.getElementById("order-popup").classList.add("hidden")}),document.getElementById("cart-order-form").addEventListener("submit",l)}C();

let r=[];const f=()=>{document.getElementById("image-input").addEventListener("change",function(c){const o=Array.from(c.target.files);if(r.length+o.length>3){alert("You can only upload 3 images for a product.");return}console.log("before push, ",o),o.forEach(t=>r.push(t)),a()})};function a(){const c=document.getElementById("preview-container");c.innerHTML="",r.forEach((o,t)=>{const e=document.createElement("div");e.classList.add("relative","border","border-gray-200","p-1","rounded","flex","items-center","justify-center");const n=document.createElement("img");n.src=URL.createObjectURL(o),n.onload=function(){URL.revokeObjectURL(n.src)},n.classList.add("object-cover","w-full","h-full","rounded");const d=document.createElement("button");d.innerHTML="&times;",d.classList.add("absolute","top-0","right-0","bg-red-500","text-white","rounded-full","w-6","h-6","flex","items-center","justify-center","text-xs","hover:bg-red-700"),d.addEventListener("click",function(){r.splice(t,1),a()}),e.appendChild(n),e.appendChild(d),c.appendChild(e)})}const h=()=>{const c=function(){const o=document.createElement("div");o.className="flex space-x-4 items-center product-specification";const t=document.createElement("input");t.type="text",t.placeholder="Specification",t.className="w-full p-2 border border-gray-300 rounded-lg",t.required=!0;const e=document.createElement("input");e.type="text",e.placeholder="Value",e.required=!0,e.className="w-full p-2 border border-gray-300 rounded-lg";const n=document.createElement("button");n.type="button",n.innerText="X",n.className="bg-red-500 text-white py-2 px-4 rounded-lg ml-1 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400",n.addEventListener("click",function(){o.remove()}),o.appendChild(t),o.appendChild(e),o.appendChild(n),document.getElementById("specificationInputs").appendChild(o)};c(),document.getElementById("add-inputs-btn").addEventListener("click",function(o){o.preventDefault(),c()})},g=()=>{const c=async o=>{console.log(r),o.preventDefault();const t=o.target,e=t.querySelector(".result"),n=t.querySelector(".submit-btn");n.disabled=!0,n.innerHTML="Submitting...",e.classList.add("hidden");try{const d=new FormData;r.forEach(i=>{i.type.match("^image/")&&d.append("Images[]",i)}),d.append("Name",t.elements.productName.value),d.append("Price",t.elements.productPrice.value),d.append("Discounted_price",t.elements.discountedPrice.value),d.append("Stock",t.elements.stock.value),d.append("Category_id",t.elements.category.value),d.append("Brand_id",t.elements.brand.value),d.append("Updating_id",t.elements.UpdatingId.value);const l=Array.from(document.querySelectorAll(".product-specification")).map(i=>({specName:i.children[0].value,specValue:i.children[1].value}));console.log(l),d.append("Specifications",JSON.stringify(l));const u={method:"POST",headers:{"Access-Control-Allow-Credentials":"true",Accept:"multipart/form-data"},credentials:"include",body:d};t.reset();const p=location.protocol+"//"+location.host+"/_api/product/",s=await fetch(p,u),m=await s.json();n.innerHTML="Submit",n.disabled=!1,r=[],a(),e.classList.remove("hidden"),s.status===200?(e.children[0].innerHTML="Product Added.",e.children[1].classList.remove("hidden"),e.children[1].href=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/product/"+m.id):(e.children[0].innerHTML="Failed to add product. Code: "+s.status,e.children[1].classList.add("hidden"))}catch{r=[],a(),n.innerHTML="Submit",n.disabled=!1,e.classList.remove("hidden"),e.children[0].innerHTML="Failed to add product. Unknown Error",e.children[1].classList.add("hidden")}};document.getElementById("new-product-panel").addEventListener("submit",c)};f();h();g();

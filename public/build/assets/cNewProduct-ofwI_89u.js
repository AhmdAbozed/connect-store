import{g as y}from"./utils-B3iq3xPc.js";let i=[];const b=()=>{document.getElementById("image-input").addEventListener("change",function(o){const c=Array.from(o.target.files);if(i.length+c.length>3){alert("You can only upload 3 images for a product.");return}console.log("before push, ",c),c.forEach(t=>i.push(t)),u()})};function v(o,c){var t;(t=document.getElementById("category-select"))==null||t.addEventListener("change",e=>{const r=Number(e.target.value);L(r,c)})}function E(o){var c;(c=document.getElementById("subcategory-select"))==null||c.addEventListener("change",t=>{const e=Number(t.target.value),r=o.find(n=>n.id==e);w(r)})}function L(o,c){const t=c.filter(n=>(console.log(n.category_id,o),n.category_id==o)),e=document.getElementById("subcategory-select");e.replaceChildren();const r=document.createElement("option");r.value="0",r.innerHTML="No subcategory",e==null||e.append(r),t.forEach(n=>{const d=document.createElement("option");d.value=n.id,d.innerHTML=n.name,e==null||e.append(d)})}function w(o){console.log(o);const c=JSON.parse(o.specifications),t=phpProducts;console.log(t),console.log(t.filter(r=>r.subcategory_id==o.id));const e=y(c,t.filter(r=>r.subcategory_id==o.id));console.log(e),c.length&&(document.getElementById("specificationInputs").replaceChildren(),document.getElementById("filterInputs").replaceChildren(),e.forEach(r=>{C(r)}),m())}function u(){const o=document.getElementById("preview-container");o.innerHTML="",i.forEach((c,t)=>{const e=document.createElement("div");e.classList.add("relative","border","border-gray-200","p-1","rounded","flex","items-center","justify-center");const r=document.createElement("img");r.src=URL.createObjectURL(c),r.onload=function(){URL.revokeObjectURL(r.src)},r.classList.add("object-cover","w-full","h-full","rounded");const n=document.createElement("button");n.innerHTML="&times;",n.classList.add("absolute","top-0","right-0","bg-red-500","text-white","rounded-full","w-6","h-6","flex","items-center","justify-center","text-xs","hover:bg-red-700"),n.addEventListener("click",function(){i.splice(t,1),u()}),e.appendChild(r),e.appendChild(n),o.appendChild(e)})}const C=function(o){const c=document.createElement("div");c.className="flex space-x-4 items-center product-specification";const t=document.createElement("div");t.className="flex text-blue-600 mb-4 mt-1";const e=document.createElement("input");e.type="text",e.placeholder="Specification",e.className="w-full p-2 border border-gray-300 rounded-lg",e.required=!0;const r=document.createElement("div");r.className="min-w-12",r.innerHTML=o.filterName,c.appendChild(r),e.value=o.filterName,e.classList.add("hidden"),o.filterChildren.forEach(l=>{const a=document.createElement("div");a.className="mr-2 cursor-pointer",a.innerHTML='"'+l.value+'"',a.addEventListener("click",()=>{document.getElementById(o.filterName).value=l.value}),t.appendChild(a)}),c.appendChild(e);const n=document.createElement("input");n.type="text",n.placeholder="Value",n.required=!0,n.className="w-full p-2 border border-gray-300 rounded-lg",n.id=o.filterName,c.appendChild(n);const d=document.createElement("button");d.type="button",d.innerText="X",d.className="bg-red-500 text-white py-2 px-4 rounded-lg ml-1 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400",d.addEventListener("click",function(){c.remove(),t.remove()}),c.appendChild(d),document.getElementById("filterInputs").appendChild(c),document.getElementById("filterInputs").appendChild(t)},m=function(){const o=document.createElement("div");o.className="flex space-x-4 items-center product-specification";const c=document.createElement("input");c.type="text",c.placeholder="Specification",c.className="w-full p-2 border border-gray-300 rounded-lg",c.required=!0,o.appendChild(c);const t=document.createElement("input");t.type="text",t.placeholder="Value",t.required=!0,t.className="w-full p-2 border border-gray-300 rounded-lg",o.appendChild(t);const e=document.createElement("button");e.type="button",e.innerText="X",e.className="bg-red-500 text-white py-2 px-4 rounded-lg ml-1 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400",e.addEventListener("click",function(){o.remove()}),o.appendChild(e),document.getElementById("specificationInputs").appendChild(o)},I=()=>{m(),document.getElementById("add-inputs-btn").addEventListener("click",function(o){o.preventDefault(),m()})},N=()=>{const o=async c=>{console.log(i),c.preventDefault();const t=c.target,e=t.querySelector(".result"),r=t.querySelector(".submit-btn");r.disabled=!0,r.innerHTML="Submitting...",e.classList.add("hidden");try{const n=new FormData;i.forEach(s=>{s.type.match("^image/")&&n.append("Images[]",s)}),n.append("Name",t.elements.productName.value),n.append("Price",t.elements.productPrice.value),n.append("Discounted_price",t.elements.discountedPrice.value),n.append("Stock",t.elements.stock.value),n.append("Category_id",t.elements.category.value),n.append("Subcategory_id",t.elements.subcategory.value),n.append("Updating_id",t.elements.UpdatingId.value);const l=Array.from(document.querySelectorAll(".product-specification")).map(s=>({specName:s.querySelectorAll("input")[0].value,specValue:s.querySelectorAll("input")[1].value}));console.log(l),n.append("Specifications",JSON.stringify(l));const a={method:"POST",headers:{"Access-Control-Allow-Credentials":"true",Accept:"multipart/form-data"},credentials:"include",body:n};console.log(n),t.reset();const f=location.protocol+"//"+location.host+"/_api/product/",p=await fetch(f,a),h=await p.json();r.innerHTML="Submit",r.disabled=!1,i=[],u(),e.classList.remove("hidden"),p.status===200?(e.children[0].innerHTML="Product Added.",e.children[1].classList.remove("hidden"),e.children[1].href=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/product/"+h.id):(e.children[0].innerHTML="Failed to add product. Code: "+p.status,e.children[1].classList.add("hidden"))}catch(n){throw console.log(n),i=[],u(),r.innerHTML="Submit",r.disabled=!1,e.classList.remove("hidden"),e.children[0].innerHTML="Failed to add product. Unknown Error",e.children[1].classList.add("hidden"),n}};document.getElementById("new-product-panel").addEventListener("submit",o)};b();I();N();const S=phpCategories,g=phpSubcategories;v(S,g);E(g);

let r=[];const h=()=>{document.getElementById("image-input").addEventListener("change",function(i){const c=Array.from(i.target.files);if(r.length+c.length>3){alert("You can only upload 3 images for a product.");return}console.log("before push, ",c),c.forEach(t=>r.push(t)),s()})};function y(i){var c;(c=document.getElementById("category-select"))==null||c.addEventListener("change",t=>{const e=Number(t.target.value),o=i.find(n=>n.id==e);v(o),b(e)})}function b(i){const t=phpSubcategories.filter(n=>(console.log(n.category_id,i),n.category_id==i)),e=document.getElementById("subcategory-select");e.replaceChildren();const o=document.createElement("option");o.value="0",o.innerHTML="No subcategory",e==null||e.append(o),t.forEach(n=>{const a=document.createElement("option");a.value=n.id,a.innerHTML=n.name,e==null||e.append(a)})}function v(i){const c=JSON.parse(i.specifications);c.length&&(document.getElementById("specificationInputs").replaceChildren(),c.forEach(t=>{u(t)}))}function s(){const i=document.getElementById("preview-container");i.innerHTML="",r.forEach((c,t)=>{const e=document.createElement("div");e.classList.add("relative","border","border-gray-200","p-1","rounded","flex","items-center","justify-center");const o=document.createElement("img");o.src=URL.createObjectURL(c),o.onload=function(){URL.revokeObjectURL(o.src)},o.classList.add("object-cover","w-full","h-full","rounded");const n=document.createElement("button");n.innerHTML="&times;",n.classList.add("absolute","top-0","right-0","bg-red-500","text-white","rounded-full","w-6","h-6","flex","items-center","justify-center","text-xs","hover:bg-red-700"),n.addEventListener("click",function(){r.splice(t,1),s()}),e.appendChild(o),e.appendChild(n),i.appendChild(e)})}const u=function(i){const c=document.createElement("div");c.className="flex space-x-4 items-center product-specification";const t=document.createElement("input");t.type="text",t.placeholder="Specification",t.className="w-full p-2 border border-gray-300 rounded-lg",t.required=!0,i&&(t.value=i);const e=document.createElement("input");e.type="text",e.placeholder="Value",e.required=!0,e.className="w-full p-2 border border-gray-300 rounded-lg";const o=document.createElement("button");o.type="button",o.innerText="X",o.className="bg-red-500 text-white py-2 px-4 rounded-lg ml-1 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400",o.addEventListener("click",function(){c.remove()}),c.appendChild(t),c.appendChild(e),c.appendChild(o),document.getElementById("specificationInputs").appendChild(c)},E=()=>{u(),document.getElementById("add-inputs-btn").addEventListener("click",function(i){i.preventDefault(),u()})},L=()=>{const i=async c=>{console.log(r),c.preventDefault();const t=c.target,e=t.querySelector(".result"),o=t.querySelector(".submit-btn");o.disabled=!0,o.innerHTML="Submitting...",e.classList.add("hidden");try{const n=new FormData;r.forEach(d=>{d.type.match("^image/")&&n.append("Images[]",d)}),n.append("Name",t.elements.productName.value),n.append("Price",t.elements.productPrice.value),n.append("Discounted_price",t.elements.discountedPrice.value),n.append("Stock",t.elements.stock.value),n.append("Category_id",t.elements.category.value),n.append("Subcategory_id",t.elements.subcategory.value),n.append("Updating_id",t.elements.UpdatingId.value);const p=Array.from(document.querySelectorAll(".product-specification")).map(d=>({specName:d.children[0].value,specValue:d.children[1].value}));console.log(p),n.append("Specifications",JSON.stringify(p));const m={method:"POST",headers:{"Access-Control-Allow-Credentials":"true",Accept:"multipart/form-data"},credentials:"include",body:n};console.log(n),t.reset();const g=location.protocol+"//"+location.host+"/_api/product/",l=await fetch(g,m),f=await l.json();o.innerHTML="Submit",o.disabled=!1,r=[],s(),e.classList.remove("hidden"),l.status===200?(e.children[0].innerHTML="Product Added.",e.children[1].classList.remove("hidden"),e.children[1].href=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/product/"+f.id):(e.children[0].innerHTML="Failed to add product. Code: "+l.status,e.children[1].classList.add("hidden"))}catch(n){throw console.log(n),r=[],s(),o.innerHTML="Submit",o.disabled=!1,e.classList.remove("hidden"),e.children[0].innerHTML="Failed to add product. Unknown Error",e.children[1].classList.add("hidden"),n}};document.getElementById("new-product-panel").addEventListener("submit",i)};h();E();L();const w=phpCategories;y(w);

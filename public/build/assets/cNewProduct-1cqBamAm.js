import{g as b}from"./utils-DM3ytNQh.js";let p=[];function v(){const c=new URLSearchParams(window.location.search),r=c.get("name"),n=c.get("price"),e=c.get("discounted_price"),o=c.get("stock"),t=c.get("category_id"),a=c.get("subcategory_id"),u=c.get("specifications");if(r){const i=document.querySelector('input[name="productName"]');i&&(i.value=r)}if(n){const i=document.querySelector('input[name="productPrice"]');i&&(i.value=n)}if(e){const i=document.querySelector('input[name="discountedPrice"]');i&&(i.value=e)}if(o){const i=document.querySelector('input[name="stock"]');i&&(i.value=o)}if(t){const i=document.querySelector('select[name="category"]');if(i){i.value=t;const l=new Event("change",{bubbles:!0});i.dispatchEvent(l)}}const d=document.querySelector('select[name="subcategory"]');if(a&&d){d.value=a;const i=new Event("change",{bubbles:!0});d.dispatchEvent(i)}if(u){const i=JSON.parse(u),l=y.find(m=>m.id==Number(a));if(console.log(JSON.parse(l.specifications)),l&&a){const m=[],g=JSON.parse(l.specifications);console.log("yup",i);for(let s=i.length-1;s>=0;s--)g.includes(i[s].specName)&&m.push(i.splice(s,1));console.log(m),m.forEach(s=>{document.querySelector("#"+s[0].specName).value=s[0].specValue}),i.forEach(s=>{h(s.specName,s.specValue)}),console.log(i)}}}const E=()=>{document.getElementById("image-input").addEventListener("change",function(c){document.getElementById("unchangedImgs").innerHTML="";const r=Array.from(c.target.files);if(p.length+r.length>3){alert("You can only upload 3 images for a product.");return}console.log("before push, ",r),r.forEach(n=>p.push(n)),f()})};function L(c,r){var n;(n=document.getElementById("category-select"))==null||n.addEventListener("change",e=>{const o=Number(e.target.value);N(o,r)})}function S(c){var r;(r=document.getElementById("subcategory-select"))==null||r.addEventListener("change",n=>{const e=Number(n.target.value),o=c.find(t=>t.id==e);w(o)})}function N(c,r){const n=r.filter(t=>(console.log(t.category_id,c),t.category_id==c)),e=document.getElementById("subcategory-select");e.replaceChildren();const o=document.createElement("option");o.value="0",o.innerHTML="No subcategory",e==null||e.append(o),n.forEach(t=>{const a=document.createElement("option");a.value=t.id,a.innerHTML=t.name,e==null||e.append(a)})}function w(c){console.log(c);const r=JSON.parse(c.specifications),n=phpProducts;console.log(n),console.log(n.filter(o=>o.subcategory_id==c.id));const e=b(r,n.filter(o=>o.subcategory_id==c.id));console.log(e),r.length&&(document.getElementById("specificationInputs").replaceChildren(),document.getElementById("filterInputs").replaceChildren(),e.forEach(o=>{I(o)}),h())}function f(){const c=document.getElementById("preview-container");c.innerHTML="",p.forEach((r,n)=>{const e=document.createElement("div");e.classList.add("relative","border","border-gray-200","p-1","rounded","flex","items-center","justify-center");const o=document.createElement("img");o.src=URL.createObjectURL(r),o.onload=function(){URL.revokeObjectURL(o.src)},o.classList.add("object-cover","w-full","h-full","rounded");const t=document.createElement("button");t.innerHTML="&times;",t.classList.add("absolute","top-0","right-0","bg-red-500","text-white","rounded-full","w-6","h-6","flex","items-center","justify-center","text-xs","hover:bg-red-700"),t.addEventListener("click",function(){p.splice(n,1),f()}),e.appendChild(o),e.appendChild(t),c.appendChild(e)})}const I=function(c){const r=document.createElement("div");r.className="flex space-x-4 items-center product-specification";const n=document.createElement("div");n.className="flex text-blue-600 mb-4 mt-1";const e=document.createElement("input");e.type="text",e.placeholder="Specification",e.className="w-full p-2 border border-gray-300 rounded-lg",e.required=!0;const o=document.createElement("div");o.className="min-w-12",o.innerHTML=c.filterName,r.appendChild(o),e.value=c.filterName,e.classList.add("hidden"),c.filterChildren.forEach(u=>{const d=document.createElement("div");d.className="mr-2 cursor-pointer",d.innerHTML='"'+u.value+'"',d.addEventListener("click",()=>{document.getElementById(c.filterName).value=u.value}),n.appendChild(d)}),r.appendChild(e);const t=document.createElement("input");t.type="text",t.placeholder="Value",t.required=!0,t.className="w-full p-2 border border-gray-300 rounded-lg",t.id=c.filterName,r.appendChild(t);const a=document.createElement("button");a.type="button",a.innerText="X",a.className="bg-red-500 text-white py-2 px-4 rounded-lg ml-1 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400",a.addEventListener("click",function(){r.remove(),n.remove()}),r.appendChild(a),document.getElementById("filterInputs").appendChild(r),document.getElementById("filterInputs").appendChild(n)},h=function(c,r){const n=document.createElement("div");n.className="flex space-x-4 items-center product-specification";const e=document.createElement("input");e.type="text",e.placeholder="Specification",e.className="w-full p-2 border border-gray-300 rounded-lg",e.required=!0,c&&(e.value=c),n.appendChild(e);const o=document.createElement("input");o.type="text",o.placeholder="Value",r&&(o.value=r),o.required=!0,o.className="w-full p-2 border border-gray-300 rounded-lg",n.appendChild(o);const t=document.createElement("button");t.type="button",t.innerText="X",t.className="bg-red-500 text-white py-2 px-4 rounded-lg ml-1 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400",t.addEventListener("click",function(){n.remove()}),n.appendChild(t),document.getElementById("specificationInputs").appendChild(n)},C=()=>{h(),document.getElementById("add-inputs-btn").addEventListener("click",function(c){c.preventDefault(),h()})},x=()=>{const c=async r=>{console.log(p),r.preventDefault();const n=r.target,e=n.querySelector(".result"),o=n.querySelector(".submit-btn");o.disabled=!0,o.innerHTML="Submitting...",e.classList.add("hidden");try{const t=new FormData;p.forEach(g=>{g.type.match("^image/")&&t.append("Images[]",g)}),t.append("Name",n.elements.productName.value),t.append("Price",n.elements.productPrice.value),t.append("Discounted_price",n.elements.discountedPrice.value),t.append("Stock",n.elements.stock.value),t.append("Category_id",n.elements.category.value),t.append("Subcategory_id",n.elements.subcategory.value),t.append("Updating_id",n.elements.UpdatingId.value);const u=Array.from(document.querySelectorAll(".product-specification")).map(g=>({specName:g.querySelectorAll("input")[0].value,specValue:g.querySelectorAll("input")[1].value}));console.log(u),t.append("Specifications",JSON.stringify(u));const d={method:"POST",headers:{"Access-Control-Allow-Credentials":"true",Accept:"multipart/form-data"},credentials:"include",body:t};console.log(t),n.reset();const i=location.protocol+"//"+location.host+"/_api/product/",l=await fetch(i,d),m=await l.json();o.innerHTML="Submit",o.disabled=!1,p=[],f(),e.classList.remove("hidden"),l.status===200?(e.children[0].innerHTML="Product Added.",e.children[1].classList.remove("hidden"),e.children[1].href=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/product/"+m.id):(e.children[0].innerHTML="Failed to add product. Code: "+l.status,e.children[1].classList.add("hidden"))}catch(t){throw console.log(t),p=[],f(),o.innerHTML="Submit",o.disabled=!1,e.classList.remove("hidden"),e.children[0].innerHTML="Failed to add product. Unknown Error",e.children[1].classList.add("hidden"),t}};document.getElementById("new-product-panel").addEventListener("submit",c)};E();C();x();const P=phpCategories,y=phpSubcategories;L(P,y);S(y);v();

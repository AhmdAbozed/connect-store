import{g as h}from"./utils-D11pOpYs.js";let i=[];const y=()=>{document.getElementById("image-input").addEventListener("change",function(o){const c=Array.from(o.target.files);if(i.length+c.length>3){alert("You can only upload 3 images for a product.");return}console.log("before push, ",c),c.forEach(n=>i.push(n)),u()})};function b(o){var c;(c=document.getElementById("category-select"))==null||c.addEventListener("change",n=>{const e=Number(n.target.value),r=o.find(t=>t.id==e);E(r),v(e)})}function v(o){const n=phpSubcategories.filter(t=>(console.log(t.category_id,o),t.category_id==o)),e=document.getElementById("subcategory-select");e.replaceChildren();const r=document.createElement("option");r.value="0",r.innerHTML="No subcategory",e==null||e.append(r),n.forEach(t=>{const d=document.createElement("option");d.value=t.id,d.innerHTML=t.name,e==null||e.append(d)})}function E(o){const c=JSON.parse(o.specifications),n=phpProducts,e=h(c,n.filter(r=>r.category_id==o.id));console.log(e),c.length&&(document.getElementById("specificationInputs").replaceChildren(),document.getElementById("filterInputs").replaceChildren(),e.forEach(r=>{L(r)}),m())}function u(){const o=document.getElementById("preview-container");o.innerHTML="",i.forEach((c,n)=>{const e=document.createElement("div");e.classList.add("relative","border","border-gray-200","p-1","rounded","flex","items-center","justify-center");const r=document.createElement("img");r.src=URL.createObjectURL(c),r.onload=function(){URL.revokeObjectURL(r.src)},r.classList.add("object-cover","w-full","h-full","rounded");const t=document.createElement("button");t.innerHTML="&times;",t.classList.add("absolute","top-0","right-0","bg-red-500","text-white","rounded-full","w-6","h-6","flex","items-center","justify-center","text-xs","hover:bg-red-700"),t.addEventListener("click",function(){i.splice(n,1),u()}),e.appendChild(r),e.appendChild(t),o.appendChild(e)})}const L=function(o){const c=document.createElement("div");c.className="flex space-x-4 items-center product-specification";const n=document.createElement("div");n.className="flex text-blue-600 mb-4 mt-1";const e=document.createElement("input");e.type="text",e.placeholder="Specification",e.className="w-full p-2 border border-gray-300 rounded-lg",e.required=!0;const r=document.createElement("div");r.className="min-w-12",r.innerHTML=o.filterName,c.appendChild(r),e.value=o.filterName,e.classList.add("hidden"),o.filterChildren.forEach(l=>{const a=document.createElement("div");a.className="mr-2 cursor-pointer",a.innerHTML='"'+l.value+'"',a.addEventListener("click",()=>{document.getElementById(o.filterName).value=l.value}),n.appendChild(a)}),c.appendChild(e);const t=document.createElement("input");t.type="text",t.placeholder="Value",t.required=!0,t.className="w-full p-2 border border-gray-300 rounded-lg",t.id=o.filterName,c.appendChild(t);const d=document.createElement("button");d.type="button",d.innerText="X",d.className="bg-red-500 text-white py-2 px-4 rounded-lg ml-1 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400",d.addEventListener("click",function(){c.remove(),n.remove()}),c.appendChild(d),document.getElementById("filterInputs").appendChild(c),document.getElementById("filterInputs").appendChild(n)},m=function(){const o=document.createElement("div");o.className="flex space-x-4 items-center product-specification";const c=document.createElement("input");c.type="text",c.placeholder="Specification",c.className="w-full p-2 border border-gray-300 rounded-lg",c.required=!0,o.appendChild(c);const n=document.createElement("input");n.type="text",n.placeholder="Value",n.required=!0,n.className="w-full p-2 border border-gray-300 rounded-lg",o.appendChild(n);const e=document.createElement("button");e.type="button",e.innerText="X",e.className="bg-red-500 text-white py-2 px-4 rounded-lg ml-1 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400",e.addEventListener("click",function(){o.remove()}),o.appendChild(e),document.getElementById("specificationInputs").appendChild(o)},w=()=>{m(),document.getElementById("add-inputs-btn").addEventListener("click",function(o){o.preventDefault(),m()})},C=()=>{const o=async c=>{console.log(i),c.preventDefault();const n=c.target,e=n.querySelector(".result"),r=n.querySelector(".submit-btn");r.disabled=!0,r.innerHTML="Submitting...",e.classList.add("hidden");try{const t=new FormData;i.forEach(s=>{s.type.match("^image/")&&t.append("Images[]",s)}),t.append("Name",n.elements.productName.value),t.append("Price",n.elements.productPrice.value),t.append("Discounted_price",n.elements.discountedPrice.value),t.append("Stock",n.elements.stock.value),t.append("Category_id",n.elements.category.value),t.append("Subcategory_id",n.elements.subcategory.value),t.append("Updating_id",n.elements.UpdatingId.value);const l=Array.from(document.querySelectorAll(".product-specification")).map(s=>({specName:s.querySelectorAll("input")[0].value,specValue:s.querySelectorAll("input")[1].value}));console.log(l),t.append("Specifications",JSON.stringify(l));const a={method:"POST",headers:{"Access-Control-Allow-Credentials":"true",Accept:"multipart/form-data"},credentials:"include",body:t};console.log(t),n.reset();const f=location.protocol+"//"+location.host+"/_api/product/",p=await fetch(f,a),g=await p.json();r.innerHTML="Submit",r.disabled=!1,i=[],u(),e.classList.remove("hidden"),p.status===200?(e.children[0].innerHTML="Product Added.",e.children[1].classList.remove("hidden"),e.children[1].href=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/product/"+g.id):(e.children[0].innerHTML="Failed to add product. Code: "+p.status,e.children[1].classList.add("hidden"))}catch(t){throw console.log(t),i=[],u(),r.innerHTML="Submit",r.disabled=!1,e.classList.remove("hidden"),e.children[0].innerHTML="Failed to add product. Unknown Error",e.children[1].classList.add("hidden"),t}};document.getElementById("new-product-panel").addEventListener("submit",o)};y();w();C();const N=phpCategories;b(N);
